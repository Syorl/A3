<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Clientes e Produtos</title>
  <link rel="stylesheet" href="../CSS/Clientes_styles.css">
</head>
<body>
  <h1>Cadastro de Produto</h1>
  <form id="produtoForm">
    <label for="produtoNome">Nome do Produto:</label>
    <input type="text" id="produtoNome" name="produtoNome" required>

    <label for="descricao">Descrição:</label>
    <input type="text" id="descricao" name="descricao" required>

    <label for="categoria">Categoria:</label>
    <input type="text" id="categoria" name="categoria" required>

    <label for="marca">Marca:</label>
    <input type="text" id="marca" name="marca" required>

    <label for="modelo">Modelo:</label>
    <input type="text" id="modelo" name="modelo" required>
    <div class="form-group">
    <label for="quantidade">Quantidade:</label>
    <input type="number" id="quantidade" name="quantidade" required>

    <label for="valor">Valor:</label>
    <input type="number" step="0.01" id="valor" name="valor" required>

    <label for="id_fornecedor">Fornecedor:</label>
    <select id="id_fornecedor" name="id_fornecedor" required>
      <option value="">Selecione um fornecedor</option>
      <!-- Fornecedores serão inseridos dinamicamente aqui -->
    </select>
    </div>
    <button type="submit">Cadastrar Produto</button>
    <button type="button" id="updateProduto">Atualizar Produto</button>
    <button type="button" id="deleteProduto">Deletar Produto</button>
  </form>

  <h2>Lista de Produtos</h2>
  <table id="produtosTable">
    <thead>
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>Descrição</th>
        <th>Categoria</th>
        <th>Marca</th>
        <th>Modelo</th>
        <th>Quantidade</th>
        <th>Valor</th>
        <th>ID Fornecedor</th>
      </tr>
    </thead>
    <tbody>
      <!-- Produtos serão inseridos dinamicamente aqui -->
    </tbody>
  </table>

  <script>
    async function carregarProdutos() {
    try {
        const response = await fetch('/api/produtos'); // Rota para obter todos os produtos
        if (response.ok) {
            const produtos = await response.json();
            const produtosContainer = document.getElementById('produtos-container');
            produtosContainer.innerHTML = ''; // Limpa a área de exibição

            produtos.forEach(produto => {
                const produtoDiv = document.createElement('div');
                produtoDiv.innerHTML = `
                    <h3>${produto.nome}</h3>
                    <p>Categoria: ${produto.categoria}</p>
                    <p>Marca: ${produto.marca}</p>
                    <p>Fornecedor: ${produto.fornecedor}</p>
                    <p>Quantidade: ${produto.quantidade}</p>
                    <button onclick="deletarProduto(${produto.id})">Deletar</button>
                    <button onclick="editarProduto(${produto.id})">Editar</button>
                `;
                produtosContainer.appendChild(produtoDiv);
            });
        } else {
            console.error('Erro ao carregar produtos:', response.statusText);
        }
    } catch (error) {
        console.error('Erro ao buscar produtos:', error);
    }
}

// Função para preencher o campo de fornecedores
async function carregarFornecedores() {
  try {
    const response = await fetch('/fornecedores');  // Verifique se esta URL está correta
    if (response.ok) {
      const fornecedores = await response.json();
      
      const fornecedorSelect = document.getElementById('id_fornecedor');
      
      // Limpa as opções existentes
      fornecedorSelect.innerHTML = '<option value="">Selecione um fornecedor</option>';
      
      // Adiciona cada fornecedor como uma opção no select
      fornecedores.forEach(fornecedor => {
        const option = document.createElement('option');
        option.value = fornecedor.id_fornecedor;
        option.textContent = fornecedor.nome;  // Supondo que o nome do fornecedor seja 'nome'
        fornecedorSelect.appendChild(option);
      });
    } else {
      console.error("Erro ao carregar fornecedores:", response.statusText);
    }
  } catch (error) {
    console.error("Erro ao carregar fornecedores:", error);
  }
}

// Carregar fornecedores ao carregar a página
window.onload = () => {
  displayProdutos();
  carregarFornecedores();  // Carrega fornecedores
};


// Função para criar um novo produto
async function criarProduto(event) {
    event.preventDefault();

    const nome = document.getElementById('nome').value;
    const categoria = document.getElementById('categoria').value;
    const marca = document.getElementById('marca').value;
    const quantidade = document.getElementById('quantidade').value;
    const valor = document.getElementById('valor').value;

    const produto = {
        nome,
        categoria,
        marca,
        quantidade,
        valor
    };

    try {
        const response = await fetch('/api/produtos', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(produto)
        });

        if (response.ok) {
            alert('Produto criado com sucesso!');
            carregarProdutos(); // Atualiza a lista de produtos
        } else {
            console.error('Erro ao criar produto:', response.statusText);
        }
    } catch (error) {
        console.error('Erro ao criar produto:', error);
    }
}

// Função para deletar um produto
async function deletarProduto(id) {
    try {
        const response = await fetch(`/api/produtos/${id}`, {
            method: 'DELETE'
        });

        if (response.ok) {
            alert('Produto deletado com sucesso!');
            carregarProdutos(); // Atualiza a lista de produtos
        } else {
            console.error('Erro ao deletar produto:', response.statusText);
        }
    } catch (error) {
        console.error('Erro ao deletar produto:', error);
    }
}

// Função para editar um produto (Exemplo, pode ser ajustado conforme a necessidade)
async function editarProduto(id) {
    const novoNome = prompt('Novo nome do produto:');
    if (!novoNome) return;

    const produtoAtualizado = {
        nome: novoNome
    };

    try {
        const response = await fetch(`/api/produtos/${id}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(produtoAtualizado)
        });

        if (response.ok) {
            alert('Produto atualizado com sucesso!');
            carregarProdutos(); // Atualiza a lista de produtos
        } else {
            console.error('Erro ao atualizar produto:', response.statusText);
        }
    } catch (error) {
        console.error('Erro ao editar produto:', error);
    }
}
  </script>
</body>
</html>
