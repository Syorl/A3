<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Estoque</title>
    <link rel="stylesheet" href="../CSS/estoque_styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Gerenciar Estoque</h1>
        <p>Adicione produtos, veja o estoque e mantenha tudo organizado!</p>
      </header>

      <section class="form-section">
        <form id="formCadastro">
          <div class="form-group">
            <label for="nome">Nome do Produto:</label>
            <input type="text" id="nome" name="nome" required />
          </div>

          <div class="form-group">
            <label for="descricao">Descrição:</label>
            <textarea id="descricao" name="descricao"></textarea>
          </div>

          <div class="form-group">
            <label for="categoria">Categoria:</label>
            <input type="text" id="categoria" name="categoria" />
          </div>

          <div class="form-group">
            <label for="marca">Marca:</label>
            <input type="text" id="marca" name="marca" />
          </div>

          <div class="form-group">
            <label for="modelo">Modelo:</label>
            <input type="text" id="modelo" name="modelo" />
          </div>

          <div class="form-group">
            <label for="fornecedor">Fornecedor:</label>
            <select id="fornecedor">
              <option value="">Selecione um fornecedor</option>
            </select>
          </div>

          <div class="form-group">
            <label for="quantidade">Quantidade:</label>
            <input type="number" id="quantidade" name="quantidade" />
          </div>

          <div class="form-group">
            <label for="valor">Valor (R$):</label>
            <input type="number" step="0.01" id="valor" name="valor" />
          </div>

          <button type="submit">Cadastrar Produto</button>
        </form>
      </section>

      <section class="table-section">
        <h2>Produtos Cadastrados</h2>
        <table id="tabelaProdutos">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Categoria</th>
              <th>Quantidade</th>
              <th>Valor</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>
    </div>

    <script>
      // Função para carregar fornecedores na lista de seleção
      document.addEventListener("DOMContentLoaded", function () {
        // URL do endpoint para buscar fornecedores
        const url = "http://localhost:3000/fornecedores";

        // Elemento dropdown para os fornecedores
        const fornecedorSelect = document.querySelector("#fornecedor");

        // Fazendo a requisição GET
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            // Iterando sobre os fornecedores recebidos
            data.forEach((fornecedor) => {
              // Criando uma opção para o select
              const option = document.createElement("option");
              option.value = fornecedor.id_fornecedor;
              option.textContent = fornecedor.nome;

              // Adicionando ao dropdown
              fornecedorSelect.appendChild(option);
            });
          })
          .catch((error) => {
            console.error("Erro ao carregar fornecedores:", error);
          });
      });

      // Função para cadastrar produto
      document
        .getElementById("formCadastro")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const formData = new FormData(event.target);
          const data = Object.fromEntries(formData);

          try {
            const response = await fetch(
              "http://localhost:3000/estoque/cadastrar",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
              }
            );

            if (response.ok) {
              alert("Produto cadastrado com sucesso!");
              listarProdutos(); // Atualiza a tabela
            } else {
              alert("Erro ao cadastrar produto.");
            }
          } catch (error) {
            console.error("Erro:", error);
          }
        });

      // Função para listar produtos
      async function listarProdutos() {
        try {
          const response = await fetch("http://localhost:3000/estoque/listar");
          const produtos = await response.json();

          const tabela = document.querySelector("#tabelaProdutos tbody");
          tabela.innerHTML = "";

          produtos.forEach((produto) => {
            const row = tabela.insertRow();
            row.innerHTML = `
                        <td>${produto.id}</td>
                        <td>${produto.nome}</td>
                        <td>${produto.categoria}</td>
                        <td>${produto.quantidade}</td>
                        <td>${produto.valor}</td>
                    `;
          });
        } catch (error) {
          console.error("Erro ao listar produtos:", error);
        }
      }

      // Carregar fornecedores e produtos na inicialização
      carregarFornecedores();
      listarProdutos();
    </script>
  </body>
</html>
