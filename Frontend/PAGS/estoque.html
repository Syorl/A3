<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestão de Estoque</title>
  <link rel="stylesheet" href="../CSS/estoque_styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Gestão de Estoque</h1>
      <p>Organize e acompanhe seus produtos, fornecedores e movimentações.</p>
    </header>

    <main>
      <!-- Cadastro de Produtos -->
      <section class="card">
        <h2>Cadastro de Produtos</h2>
        <form id="product-form">
          <label>Nome do Produto:
            <input type="text" id="product-name" placeholder="Ex.: Notebook" required />
          </label>
          <label>Descrição:
            <textarea id="product-description" placeholder="Ex.: Notebook com 16GB RAM"></textarea>
          </label>
          <label>Categoria:
            <input type="text" id="product-category" placeholder="Ex.: Eletrônicos" />
          </label>
          <label>Marca:
            <input type="text" id="product-brand" placeholder="Ex.: Dell" />
          </label>
          <label>Modelo:
            <input type="text" id="product-model" placeholder="Ex.: Inspiron 15" />
          </label>
          <label>Especificações Técnicas:
            <textarea id="product-specs" placeholder="Ex.: Processador i7, 512GB SSD"></textarea>
          </label>
          <label>Fornecedor:
            <select id="product-supplier" required>
              <option value="" disabled selected>Selecione um fornecedor</option>
              <!-- Os fornecedores serão carregados aqui dinamicamente -->
            </select>
          </label>
          <label>Valor (R$):
            <input type="number" id="product-value" placeholder="Ex.: 2500.00" required />
          </label>
          <button type="submit">Cadastrar Produto</button>
        </form>
      </section>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const supplierSelect = document.getElementById("product-supplier");

      try {
        const response = await fetch('/fornecedores'); // Requisição para buscar fornecedores
        if (response.ok) {
          const fornecedores = await response.json(); // Obtém a lista de fornecedores

          // Preenche o campo de seleção com os fornecedores
          fornecedores.forEach(fornecedor => {
            const option = document.createElement("option");
            option.value = fornecedor.id_fornecedor; // Usando o id_fornecedor como valor
            option.textContent = fornecedor.nome; // Exibindo o nome do fornecedor
            supplierSelect.appendChild(option); // Adiciona a opção ao select
          });
        } else {
          console.error("Erro ao carregar fornecedores");
        }
      } catch (error) {
        console.error("Erro na requisição:", error);
      }
    });

    const productForm = document.getElementById("product-form");

    // Função para registrar novo produto
    productForm.addEventListener("submit", async function(event) {
      event.preventDefault();

      const name = document.getElementById("product-name").value;
      const description = document.getElementById("product-description").value;
      const category = document.getElementById("product-category").value;
      const brand = document.getElementById("product-brand").value;
      const model = document.getElementById("product-model").value;
      const specs = document.getElementById("product-specs").value;
      const supplier = document.getElementById("product-supplier").value;
      const value = parseFloat(document.getElementById("product-value").value);

      // Cadastro de produto no banco de dados
      const response = await fetch('/produtos/cadastrar', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name,
          description,
          category,
          brand,
          model,
          specs,
          supplier,
          value
        })
      });

      if (response.ok) {
        alert("Produto cadastrado com sucesso");
        displayProducts(); // Atualiza a lista de produtos no datalist
      } else {
        const errorMessage = await response.text();
        console.error("Erro ao cadastrar produto:", errorMessage);
        alert("Erro ao cadastrar produto: " + errorMessage);
      }
    });
  </script>
</body>
</html>

