<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relatório de Produtos</title>
  <link rel="stylesheet" href="../CSS/relatorioProdutos_styles.css">
</head>
<body>
  <header>
    <h1>Relatório de Produtos</h1>
  </header>

  <!-- Relatório de Produtos Mais Vendidos -->
  <section>
    <h2>Relatório de Produtos Mais Vendidos</h2>
    <table id="bestSellingTable">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Vendas</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dados serão preenchidos dinamicamente -->
      </tbody>
    </table>
  </section>

  <!-- Relatório de Produto por Cliente -->
  <section>
    <h2>Relatório de Produto por Cliente</h2>
    <table id="productByCustomerTable">
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Produto</th>
          <th>Quantidade</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dados serão preenchidos dinamicamente -->
      </tbody>
    </table>
  </section>

  <!-- Relatório de Consumo Médio do Cliente -->
  <section>
    <h2>Relatório de Consumo Médio do Cliente</h2>
    <table id="avgConsumptionTable">
      <thead>
        <tr>
          <th>Cliente</th>
          <th>Consumo Médio</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dados serão preenchidos dinamicamente -->
      </tbody>
    </table>
  </section>

  <!-- Relatório de Produtos com Baixo Estoque -->
  <section>
    <h2>Relatório de Produtos com Baixo Estoque</h2>
    <table id="lowStockTable">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade em Estoque</th>
        </tr>
      </thead>
      <tbody>
        <!-- Dados serão preenchidos dinamicamente -->
      </tbody>
    </table>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Função para buscar os dados do controlador
      const fetchData = async () => {
        try {
          const response = await fetch('../controllers/relatorioController.js');
          if (!response.ok) {
            throw new Error('Erro ao buscar dados');
          }
          return await response.json();
        } catch (error) {
          console.error('Erro ao buscar dados:', error);
          return null;
        }
      };

      const data = await fetchData();
      if (data) {
        // Produtos mais vendidos
        const bestSellingProducts = data.bestSellingProducts;
        const bestSellingTableBody = document.getElementById('bestSellingTable').getElementsByTagName('tbody')[0];
        bestSellingProducts.forEach(produto => {
          const row = bestSellingTableBody.insertRow();
          const cellNome = row.insertCell(0);
          const cellVendas = row.insertCell(1);
          cellNome.textContent = produto.nome;
          cellVendas.textContent = produto.vendas;
        });

        // Produto por cliente
        const productByCustomer = data.productByCustomer;
        const productByCustomerTableBody = document.getElementById('productByCustomerTable').getElementsByTagName('tbody')[0];
        productByCustomer.forEach(item => {
          const row = productByCustomerTableBody.insertRow();
          const cellCliente = row.insertCell(0);
          const cellProduto = row.insertCell(1);
          const cellQuantidade = row.insertCell(2);
          cellCliente.textContent = item.cliente;
          cellProduto.textContent = item.produto;
          cellQuantidade.textContent = item.quantidade;
        });

        // Consumo médio por cliente
        const avgConsumptionData = data.avgConsumption;
        const avgConsumptionTableBody = document.getElementById('avgConsumptionTable').getElementsByTagName('tbody')[0];
        avgConsumptionData.forEach(item => {
          const row = avgConsumptionTableBody.insertRow();
          const cellCliente = row.insertCell(0);
          const cellConsumoMedio = row.insertCell(1);
          cellCliente.textContent = item.cliente;
          cellConsumoMedio.textContent = item.consumoMedio;
        });

        // Produtos com baixo estoque
        const lowStockProducts = data.lowStockProducts;
        const lowStockTableBody = document.getElementById('lowStockTable').getElementsByTagName('tbody')[0];
        lowStockProducts.forEach(produto => {
          const row = lowStockTableBody.insertRow();
          const cellProduto = row.insertCell(0);
          const cellEstoque = row.insertCell(1);
          cellProduto.textContent = produto.nome;
          cellEstoque.textContent = produto.estoque;
        });
      }
    });
  </script>
</body>
</html>
