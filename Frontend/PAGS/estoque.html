<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Produtos</title>
    <link rel="stylesheet" href="../CSS/estoque_styles.css">
</head>
<body>
    <header>
        <h1>Gerenciamento de Produtos</h1>
    </header>
    <main>
        <!-- Formulário de Cadastro de Produtos -->
        <section>
            <h2>Cadastro de Produto</h2>
            <form id="product-form">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" required>

                <label for="descricao">Descrição:</label>
                <textarea id="descricao" name="descricao" required></textarea>

                <label for="categoria">Categoria:</label>
                <input type="text" id="categoria" name="categoria" required>

                <label for="marca">Marca:</label>
                <input type="text" id="marca" name="marca" required>

                <label for="modelo">Modelo:</label>
                <input type="text" id="modelo" name="modelo" required>

                <label for="quantidade">Quantidade:</label>
                <input type="number" id="quantidade" name="quantidade" required>

                <label for="valor">Valor (R$):</label>
                <input type="number" step="0.01" id="valor" name="valor" required>

                <button type="submit" class="btn-submit">Cadastrar Produto</button>
            </form>
            <div id="status-message"></div> <!-- Mensagem de status -->
        </section>

        <!-- Lista de Produtos -->
        <section>
            <h2>Lista de Produtos</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Descrição</th>
                        <th>Categoria</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>Quantidade</th>
                        <th>Valor (R$)</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="product-list">
                    <!-- Dados preenchidos dinamicamente -->
                </tbody>
            </table>
        </section>
    </main>
    <footer>
        <p>&copy; 2024 Gerenciamento de Produtos</p>
    </footer>

    <script>
        const statusMessage = document.getElementById('status-message');

        // Função para exibir mensagens de status
        function showMessage(message, isSuccess = true) {
            statusMessage.textContent = message;
            statusMessage.style.color = isSuccess ? 'green' : 'red';
            setTimeout(() => statusMessage.textContent = '', 3000); // Limpa mensagem após 3 segundos
        }

        // Função para listar produtos dinamicamente
        async function listarProdutos() {
            try {
                // Realiza a requisição para obter a lista de produtos do servidor
                const response = await fetch('/produto'); // Endpoint da API
                if (!response.ok) throw new Error('Erro ao carregar os produtos.');

                // Converte a resposta para JSON
                const produtos = await response.json();
                const tabela = document.getElementById('product-list');
                tabela.innerHTML = ''; // Limpa a tabela

                // Preenche a tabela com os produtos
                produtos.forEach(produto => {
                    const row = `
                        <tr>
                            <td>${produto.id}</td>
                            <td>${produto.nome}</td>
                            <td>${produto.descricao}</td>
                            <td>${produto.categoria}</td>
                            <td>${produto.marca}</td>
                            <td>${produto.modelo}</td>
                            <td>${produto.quantidade}</td>
                            <td>${produto.valor.toFixed(2)}</td>
                            <td>
                                <button class="btn-edit" data-id="${produto.id}">Editar</button>
                                <button class="btn-delete" data-id="${produto.id}">Excluir</button>
                            </td>
                        </tr>
                    `;
                    tabela.innerHTML += row;
                });
                showMessage('Produtos carregados com sucesso!');
            } catch (error) {
                console.error(error);
                showMessage('Erro ao carregar produtos.', false);
            }
        }

        // Função para cadastrar novo produto
        async function cadastrarProduto(event) {
            event.preventDefault();

            // Coleta os dados do formulário
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData);

            try {
                // Realiza a requisição para cadastrar o produto
                const response = await fetch('/produto/adicionar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Erro ao cadastrar produto.');

                showMessage('Produto cadastrado com sucesso!');
                event.target.reset(); // Limpa o formulário
                listarProdutos(); // Atualiza a lista após cadastro
            } catch (error) {
                console.error(error);
                showMessage('Erro ao cadastrar produto.', false);
            }
        }

        // Adiciona o evento de submit ao formulário
        document.getElementById('product-form').addEventListener('submit', cadastrarProduto);

        // Carrega os produtos ao abrir a página
        document.addEventListener('DOMContentLoaded', listarProdutos);
    </script>
</body>
</html>
